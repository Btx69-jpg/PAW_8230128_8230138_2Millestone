<div class="container py-4">
  <h2 class="mb-4">ENTREGA</h2>

<ng-container *ngIf=" user && user.cart && user.cart.itens != null && user.cart.itens.length; else emptyCart">

  <div class="row">
    <!-- Opções de entrega -->
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-body">
          <p>Por favor, escolhe se pretendes receber a tua encomenda numa morada ou levantar numa loja.</p>

          <div class="d-flex gap-4">
            <div class="form-check">
              <input class="form-check-input" type="radio" id="homeDelivery" name="deliveryOption"
                [(ngModel)]="selectedOption" value="home">
              <label class="form-check-label" for="homeDelivery">
                <i class="bi bi-truck"></i> Desejo receber a encomenda numa morada
              </label>
            </div>

            <div class="form-check">
              <input class="form-check-input" type="radio" id="storePickup" name="deliveryOption"
                [(ngModel)]="selectedOption" value="store">
              <label class="form-check-label" for="storePickup">
                <i class="bi bi-shop"></i> Desejo levantar a encomenda em loja
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Seleção de morada ou loja fictícia -->
      <div class="card">
        <div class="card-body">
          <h5>Onde devemos entregar a encomenda?</h5>
          <div *ngIf="selectedOption === 'home'">
            <p>{{user.firstName}}</p>
                <ng-container *ngIf=" user.addresses; else noAdresses">
                    <tr *ngFor="let address of user.addresses">
                        <p class="mb-1"> {{user.firstName}} {{user.lastName}}</p>
                    </tr>
                </ng-container>
                <ng-template #noAdresses>
                    <div class="alert alert-info">
                        Não tem moradas associadas.
                    </div>
                    <button class="btn btn-primary" id="OrangeButton" (click)="goBack()">Adicionar morada</button>
                </ng-template>
            <!-- Aqui pode ir uma lista de moradas ou um formulário -->
          </div>
          <div *ngIf="selectedOption === 'store'">
            <p class="mb-1">Proceda ao pagamento</p>
            <!-- Lista de lojas (pode ser mock) -->
          </div>
        </div>
      </div>
    </div>

    <!-- Resumo -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
        <ng-container *ngIf="user.cart.price">
          <h5>Resumo dos Pedidos</h5>
          <p>Produtos: {{ user.cart.itens.length }}</p>
          <p>Subtotal: € {{ user.cart.price | number:'1.2-2' }}</p>
          <p>IVA (23%): € {{ user.cart.price * 0.23 | number:'1.2-2' }}</p>
          <hr>
          <p><strong>TOTAL: € {{ user.cart.price * 1.23 | number:'1.2-2' }}</strong></p>
        </ng-container>
        </div>
      </div>

      <div class="card mt-3" *ngIf="user.cart?.itens?.length">
        <div class="card-body">
          <h6>Detalhes do Pedido</h6>
          <div *ngFor="let item of user.cart?.itens" class="d-flex align-items-center mb-2">
            <img src="assets/imgs/product-placeholder.png" width="50" class="me-2">
            <div>
              <div>{{ item.item }}</div>
              <div class="text-muted small">{{ item.portion }}</div>
              <div class="text-danger fw-bold">€ {{ item.price | number:'1.2-2' }}</div>
            </div>
          </div>
        </div>
      </div>

      <button class="btn btn-primary w-100 mt-3" (click)="goToPayment()">Avançar para o Pagamento</button>
    </div>
  </div>
  </ng-container>

    <ng-template #emptyCart>
    <div class="alert alert-info">
      Não há itens no carrinho no momento.
    </div>
    <button class="btn btn-primary" id="OrangeButton" (click)="goBack()">Voltar aos Produtos</button>
  </ng-template>
</div>
